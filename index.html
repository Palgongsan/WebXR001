<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>CERAGEM V11 AR - DOM Overlay Slot Test</title>
    <script type="module" src="./libs/model-viewer.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
        }

        model-viewer {
            width: 100%;
            height: 600px;
            background-color: #f0f0f0;
        }

        /* DOM Overlay ì»¨í…Œì´ë„ˆ - model-viewer ë‚´ë¶€ slotìš© */
        .overlay-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 16px;
            pointer-events: none;
        }

        .overlay-content button {
            background: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            pointer-events: auto;
        }

        /* AR ì„¸ì…˜ ì¤‘ì—ë§Œ í‘œì‹œ */
        .overlay-content {
            display: none;
        }

        model-viewer[ar-tracking="tracking"] .overlay-content {
            display: flex;
        }
    </style>
</head>
<body>
    <h1>DOM Overlay Slot ë°©ì‹ í…ŒìŠ¤íŠ¸</h1>
    
    <!-- DOM overlayë¥¼ model-viewer ë‚´ë¶€ì— slotìœ¼ë¡œ ë°°ì¹˜ -->
    <model-viewer
        id="viewer"
        src="./src/CERA_V11_low_Draco6_WebP_4K_001_self_optimize.glb"
        poster="./img/V11_thumbnail.webp"
        alt="ì„¸ë¼ì ¬ V11"
        camera-controls
        ar
        ar-modes="webxr"
        ar-placement="floor"
    >
        <!-- AR ë²„íŠ¼ -->
        <button slot="ar-button">ARë¡œ ë³´ê¸°</button>
        
        <!-- DOM Overlay ì½˜í…ì¸ ë¥¼ model-viewer ë‚´ë¶€ì— ë°°ì¹˜ -->
        <div class="overlay-content" slot="ar" id="ar-overlay">
            <button onclick="handleModeChange()">ëª¨ë“œ ì „í™˜</button>
            <button onclick="handleTextureChange()">í…ìŠ¤ì²˜ ë³€ê²½</button>
            <button onclick="handleRotate()">90Â° íšŒì „</button>
        </div>
    </model-viewer>

    <script>
        const viewer = document.getElementById('viewer');
        const overlay = document.getElementById('ar-overlay');
        
        // AR ìƒíƒœ ëª¨ë‹ˆí„°ë§
        viewer.addEventListener('ar-status', (event) => {
            const status = event.detail.status;
            console.log('AR Status:', status);
            
            if (status === 'session-started') {
                console.log('âœ… AR ì„¸ì…˜ ì‹œì‘');
                overlay.style.display = 'flex';
                
                // ì„¸ì…˜ ì •ë³´ í™•ì¸
                setTimeout(() => {
                    if (viewer.xrSession) {
                        console.log('XR Session:', viewer.xrSession);
                        console.log('DOM Overlay State:', viewer.xrSession.domOverlayState);
                        
                        if (viewer.xrSession.domOverlayState) {
                            console.log('âœ… DOM Overlay í™œì„±í™”ë¨');
                        } else {
                            console.warn('âš ï¸ DOM Overlay ë¯¸ì§€ì›');
                        }
                    }
                }, 100);
            } else if (status === 'not-presenting') {
                console.log('ğŸ”´ AR ì„¸ì…˜ ì¢…ë£Œ');
                overlay.style.display = 'none';
            }
        });
        
        // AR tracking ìƒíƒœ ëª¨ë‹ˆí„°ë§
        viewer.addEventListener('ar-tracking', (event) => {
            console.log('AR Tracking:', event.detail.status);
        });
        
        // ë²„íŠ¼ í•¸ë“¤ëŸ¬
        function handleModeChange() {
            console.log('ëª¨ë“œ ì „í™˜ í´ë¦­');
            // ì• ë‹ˆë©”ì´ì…˜ ë³€ê²½ ë¡œì§
        }
        
        function handleTextureChange() {
            console.log('í…ìŠ¤ì²˜ ë³€ê²½ í´ë¦­');
            // í…ìŠ¤ì²˜ ë³€ê²½ ë¡œì§
        }
        
        function handleRotate() {
            console.log('íšŒì „ í´ë¦­');
            // íšŒì „ ë¡œì§
        }
        
        // ëª¨ë¸ ë¡œë“œ í™•ì¸
        viewer.addEventListener('load', () => {
            console.log('âœ… ëª¨ë¸ ë¡œë“œ ì™„ë£Œ');
            console.log('AR ì§€ì›:', viewer.canActivateAR);
        });
    </script>
</body>
</html>
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>WebXR Demo — modelviewer.dev UI mimic</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>
  <style>
    :root { color-scheme: light; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    main { display:grid; grid-template-columns: 1fr 1fr; min-height: 100vh; }
    .copy { padding: 32px; background:#f6f7fb; }
    .copy h1 { margin:0 0 12px; font-size: 28px; }
    .copy p { line-height:1.55; color:#444; }
    model-viewer { width: 100%; height: 100vh; display:block; background:#fff; --poster-color:transparent; }

    /* Example-like UI */
    #ar-button {
      position:absolute; left:50%; transform:translateX(-50%); bottom:16px;
      background:#fff; color:#111; border:0; border-radius:20px; padding:10px 16px; font-weight:700; z-index:5;
      box-shadow: 0 4px 20px rgba(0,0,0,.18);
      display:inline-flex; align-items:center; gap:8px;
    }
    #ar-button img { height:24px; }
    #ar-prompt { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); display:none; pointer-events:none; z-index:4; }
    #ar-prompt img { animation:pulse 2s infinite ease-in-out; }
    @keyframes pulse {
      from { transform:translate(-50%,-50%) scale(1); opacity:.9; }
      50%  { transform:translate(-50%,-50%) scale(1.08); opacity:.6; }
      to   { transform:translate(-50%,-50%) scale(1); opacity:.9; }
    }
    #ar-failure { position:absolute; left:50%; transform:translateX(-50%); top:16px; display:none; z-index:5; background:#ffefef; color:#b00020; padding:8px 12px; border-radius:10px; font-weight:600; box-shadow:0 2px 12px rgba(0,0,0,.15); }

    model-viewer[ar-status="session-started"] #ar-prompt { display:block; }
    model-viewer[ar-status="failed"] #ar-failure { display:block; }

    /* DOM overlay carousel */
    #ar-overlay { position:fixed; inset:0; display:none; pointer-events:none; }
    #ar-overlay * { pointer-events:auto; }
    model-viewer[ar-status="session-started"] #ar-overlay,
    model-viewer[ar-status="object-placed"]   #ar-overlay { display:block; }
    .slider { position:absolute; left:0; right:0; bottom:0; display:flex; justify-content:center; padding:12px; }
    .slides { display:flex; gap:8px; background:rgba(0,0,0,.4); padding:8px; border-radius:12px; backdrop-filter: blur(6px); }
    .slide { width:56px; height:56px; border-radius:8px; background-size:cover; background-position:center; border:2px solid rgba(255,255,255,.6); outline:none; }
    .slide.selected { outline:3px solid #fff; }
  </style>
</head>
<body>
  <main>
    <section class="copy">
      <h1>WebXR Demo</h1>
      <p>Customize a WebXR Augmented Reality session with HTML, CSS, and JS in Chrome 83+ on Android.</p>
      <p>이 페이지는 <code>modelviewer.dev</code>의 AR 예제 UI를 모방한 테스트 파일입니다. DOM Overlay 검증을 위해 3D 모델은 데이터 URI로 인라인된 간단한 삼각형으로 대체했습니다.</p>
      <pre style="font-size:12px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:12px;overflow:auto;">&lt;model-viewer ar ar-modes="webxr" ...&gt; ... &lt;/model-viewer&gt;</pre>
    </section>

    <model-viewer id="mv"
      src="data:model/gltf+json;base64,eyJhc3NldCI6IHsidmVyc2lvbiI6ICIyLjAifSwgInNjZW5lcyI6IFt7Im5vZGVzIjogWzBdfV0sICJzY2VuZSI6IDAsICJub2RlcyI6IFt7Im1lc2giOiAwfV0sICJtZXNoZXMiOiBbeyJwcmltaXRpdmVzIjogW3siYXR0cmlidXRlcyI6IHsiUE9TSVRJT04iOiAwfSwgImluZGljZXMiOiAxLCAibW9kZSI6IDR9XX1dLCAiYnVmZmVycyI6IFt7ImJ5dGVMZW5ndGgiOiA0MiwgInVyaSI6ICJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsQUFBQUFBQUFBQUFBQUFBQUFBQUFQd0FBQUFBQUFBQUFBQUFBQUFBQUFEOEFBQUFBQUFBQkFBSUEifV0sICJidWZmZXJWaWV3cyI6IFt7ImJ1ZmZlciI6IDAsICJieXRlT2Zmc2V0IjogMCwgImJ5dGVMZW5ndGgiOiAzNiwgInRhcmdldCI6IDM0OTYyfSwgeyJidWZmZXIiOiAwLCAiYnl0ZU9mZnNldCI6IDM2LCAiYnl0ZUxlbmd0aCI6IDYsICJ0YXJnZXQiOiAzNDk2M31dLCAiYWNjZXNzb3JzIjogW3siYnVmZmVyVmlldyI6IDAsICJieXRlT2Zmc2V0IjogMCwgImNvbXBvbmVudFR5cGUiOiA1MTI2LCAiY291bnQiOiAzLCAidHlwZSI6ICJWRUMzIiwgIm1pbiI6IFswLjAsIDAuMCwgMC4wXSwgIm1heCI6IFswLjUsIDAuNSwgMC4wXX0sIHsiYnVmZmVyVmlldyI6IDEsICJieXRlT2Zmc2V0IjogMCwgImNvbXBvbmVudFR5cGUiOiA1MTIzLCAiY291bnQiOiAzLCAidHlwZSI6ICJTQ0FMQVIifV19"
      alt="Inline triangle"
      camera-controls
      touch-action="pan-y"
      ar
      ar-modes="webxr"
      ar-placement="floor"
      ar-scale="fixed">

      <button slot="ar-button" id="ar-button" type="button">
        <img src="/img/AR in.png" alt="AR in"> View in your space
      </button>

      <div id="ar-prompt">
        <img src="/img/AR in.png" alt="move phone">
      </div>

      <button id="ar-failure" slot="ar-status">AR is not tracking!</button>

      <div id="ar-overlay" slot="ar-dom-overlay">
        <div class="slider">
          <div class="slides">
            <button class="slide selected" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box A"></button>
            <button class="slide" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box B"></button>
            <button class="slide" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box C"></button>
          </div>
        </div>
      </div>
    </model-viewer>
  </main>

  <script type="module">
    const mv = document.getElementById('mv');
    document.getElementById('ar-button')?.addEventListener('click', async (e) => {
      e.preventDefault();
      try { await mv.enterAR(); } catch (err) { console.warn('enterAR error', err); }
    });

    // Prevent XR gesture capture on overlay
    document.querySelector('.slider')?.addEventListener('beforexrselect', (ev) => ev.preventDefault());

    // In this mimic demo, switching boxes just toggles a selected class (same inline model)
    window.switchBox = (btn) => {
      document.querySelectorAll('.slide').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    };

    // Debug log for overlay state
    mv.addEventListener('ar-status', ()=> {
      const s = mv.xrSession;
      console.log('[AR] status=', mv.getAttribute('ar-status'), 'domOverlayState=', s?.domOverlayState?.type ?? 'none');
    });
  </script>
</body>
</html>

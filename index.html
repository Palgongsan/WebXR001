<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>WebXR Demo — modelviewer.dev UI mimic (Inline Cube)</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script>
  <style>
    :root { color-scheme: light; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:#f5f6f8; }
    main { display:grid; grid-template-columns: 1fr 1fr; min-height: 100vh; }
    @media (max-width: 860px) { main { grid-template-columns: 1fr; } }
    .copy { padding: 32px; }
    .copy h1 { margin:0 0 12px; font-size: 28px; }
    .copy p { line-height:1.55; color:#444; }
    model-viewer { width: 100%; height: 100vh; display:block; background:#fff; --poster-color: #ffffff; border-left:1px solid #e5e7eb; position: relative; }

    /* example-like UI */
    #ar-button {
      position:absolute; left:50%; transform:translateX(-50%); bottom:16px;
      background:#fff; color:#111; border:0; border-radius:20px; padding:10px 16px; font-weight:700; z-index:5;
      box-shadow: 0 4px 20px rgba(0,0,0,.18);
      display:inline-flex; align-items:center; gap:8px;
    }
    #ar-button img { height:24px; }
    #ar-prompt { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); display:none; pointer-events:none; z-index:4; }
    #ar-prompt img { height:48px; animation:pulse 2s infinite ease-in-out; }
    @keyframes pulse {
      from { transform:translate(-50%,-50%) scale(1); opacity:.9; }
      50%  { transform:translate(-50%,-50%) scale(1.08); opacity:.6; }
      to   { transform:translate(-50%,-50%) scale(1); opacity:.9; }
    }
    #ar-failure { position:absolute; left:50%; transform:translateX(-50%); top:16px; display:none; z-index:5; background:#ffefef; color:#b00020; padding:8px 12px; border-radius:10px; font-weight:600; box-shadow:0 2px 12px rgba(0,0,0,.15); }

    model-viewer[ar-status="session-started"] #ar-prompt { display:block; }
    model-viewer[ar-status="failed"] #ar-failure { display:block; }

    /* DOM overlay carousel */
    #ar-overlay { position:fixed; inset:0; display:none; pointer-events:none; }
    #ar-overlay * { pointer-events:auto; }
    model-viewer[ar-status="session-started"] #ar-overlay,
    model-viewer[ar-status="object-placed"]   #ar-overlay { display:block; }
    .slider { position:absolute; left:0; right:0; bottom:0; display:flex; justify-content:center; padding:12px; }
    .slides { display:flex; gap:8px; background:rgba(0,0,0,.4); padding:8px; border-radius:12px; backdrop-filter: blur(6px); }
    .slide { width:56px; height:56px; border-radius:8px; background-size:cover; background-position:center; border:2px solid rgba(255,255,255,.6); outline:none; }
    .slide.selected { outline:3px solid #fff; }

    /* helper to visualize viewer area */
    .mv-frame::after { content:""; position:absolute; inset:0; pointer-events:none; box-shadow: inset 0 0 0 2px rgba(0,0,0,.05); }
  </style>
</head>
<body>
  <main>
    <section class="copy">
      <h1>WebXR Demo</h1>
      <p>Customize a WebXR Augmented Reality session with HTML, CSS, and JS in Chrome 83+ on Android.</p>
      <p>이 페이지는 modelviewer.dev의 AR 예제 UI를 모방한 테스트 파일입니다. 외부 리소스 없이 <strong>인라인 glTF(빨간 큐브)</strong>를 사용합니다.</p>
      <pre style="font-size:12px;background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:12px;overflow:auto;">&lt;model-viewer ar ar-modes="webxr" ...&gt; ... &lt;/model-viewer&gt;</pre>
    </section>

    <model-viewer id="mv" class="mv-frame"
      src="data:model/gltf+json;base64,eyJhc3NldCI6IHsidmVyc2lvbiI6ICIyLjAifSwgInNjZW5lcyI6IFt7Im5vZGVzIjogWzBdfV0sICJzY2VuZSI6IDAsICJub2RlcyI6IFt7Im1lc2giOiAwfV0sICJtZXNoZXMiOiBbeyJwcmltaXRpdmVzIjogW3siYXR0cmlidXRlcyI6IHsiUE9TSVRJT04iOiAwfSwgImluZGljZXMiOiAxLCAibWF0ZXJpYWwiOiAwLCAibW9kZSI6IDR9XX1dLCAibWF0ZXJpYWxzIjogW3sicGJyTWV0YWxsaWNSb3VnaG5lc3MiOiB7ImJhc2VDb2xvckZhY3RvciI6IFswLjksIDAuMiwgMC4yLCAxLjBdLCAibWV0YWxsaWNGYWN0b3IiOiAwLjAsICJyb3VnaG5lc3NGYWN0b3IiOiAxLjB9fV0sICJidWZmZXJzIjogW3siYnl0ZUxlbmd0aCI6IDE2OCwgInVyaSI6ICJkYXRhOmFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbTtiYXNlNjQsQUFBQUFBQUFBQUFBQUFBQUFBQ0FQd0FBQUFBQUFBQUFBQUNBUHdBQWdEOEFBQUFBQUFBQUFBQUFnRDhBQUFBQUFBQUFBQUFBQUFBQUFJQS9BQUNBUHdBQUFBQUFBSUEvQUFDQVB3QUFnRDhBQUlBL0FBQUFBQUFBZ0Q4QUFJQS9BQUFCQUFJQUFBQUNBQU1BQkFBR0FBVUFCQUFIQUFZQUFBQUVBQVVBQUFBRkFBRUFBd0FDQUFZQUF3QUdBQWNBQVFBRkFBWUFBUUFHQUFJQUFBQURBQWNBQUFBSEFBUUEifV0sICJidWZmZXJWaWV3cyI6IFt7ImJ1ZmZlciI6IDAsICJieXRlT2Zmc2V0IjogMCwgImJ5dGVMZW5ndGgiOiA5NiwgInRhcmdldCI6IDM0OTYyfSwgeyJidWZmZXIiOiAwLCAiYnl0ZU9mZnNldCI6IDk2LCAiYnl0ZUxlbmd0aCI6IDcyLCAidGFyZ2V0IjogMzQ5NjN9XSwgImFjY2Vzc29ycyI6IFt7ImJ1ZmZlclZpZXciOiAwLCAiYnl0ZU9mZnNldCI6IDAsICJjb21wb25lbnRUeXBlIjogNTEyNiwgImNvdW50IjogOCwgInR5cGUiOiAiVkVDMyIsICJtaW4iOiBbMC4wLCAwLjAsIDAuMF0sICJtYXgiOiBbMS4wLCAxLjAsIDEuMF19LCB7ImJ1ZmZlclZpZXciOiAxLCAiYnl0ZU9mZnNldCI6IDAsICJjb21wb25lbnRUeXBlIjogNTEyMywgImNvdW50IjogMzYsICJ0eXBlIjogIlNDQUxBUiJ9XX0="
      exposure="1.0"
      environment-image="neutral"
      alt="Inline cube"
      camera-controls
      touch-action="pan-y"
      ar
      ar-modes="webxr"
      ar-placement="floor"
      ar-scale="fixed">

      <button slot="ar-button" id="ar-button" type="button">
        <img src="/img/AR in.png" alt="AR in"> View in your space
      </button>

      <div id="ar-prompt">
        <img src="/img/AR in.png" alt="move phone">
      </div>

      <button id="ar-failure" slot="ar-status">AR is not tracking!</button>

      <div id="ar-overlay" slot="ar-dom-overlay">
        <div class="slider">
          <div class="slides">
            <button class="slide selected" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box A"></button>
            <button class="slide" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box B"></button>
            <button class="slide" onclick="switchBox(this)" style="background-image:url('/img/AR in.png');" title="Box C"></button>
          </div>
        </div>
      </div>
    </model-viewer>
  </main>

  <script type="module">
    const mv = document.getElementById('mv');
    document.getElementById('ar-button')?.addEventListener('click', async (e) => {
      e.preventDefault();
      try { await mv.enterAR(); } catch (err) { console.warn('enterAR error', err); }
    });

    // Prevent XR gesture capture on overlay
    document.querySelector('.slider')?.addEventListener('beforexrselect', (ev) => ev.preventDefault());

    // Demo: UI only toggles selection (model is fixed)
    window.switchBox = (btn) => {
      document.querySelectorAll('.slide').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    };

    // Debug log for overlay state
    mv.addEventListener('ar-status', ()=> {
      const s = mv.xrSession;
      console.log('[AR] status=', mv.getAttribute('ar-status'), 'domOverlayState=', s?.domOverlayState?.type ?? 'none');
    });
  </script>
</body>
</html>

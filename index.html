<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>CERAGEM V11 AR Test - Simplified</title>
    <script type="module" src="./libs/model-viewer.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
        }

        model-viewer {
            width: 100%;
            height: 600px;
            background-color: #f0f0f0;
        }

        /* AR 세션 중에만 표시되는 버튼들 */
        .ar-controls {
            position: fixed;
            bottom: 16px;
            left: 16px;
            right: 16px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 1;
        }

        /* ar-status 속성 기반 스타일링 - model-viewer 공식 방식 */
        model-viewer[ar-status="session-started"] ~ .ar-controls {
            display: flex;
        }

        .ar-button {
            background: white;
            border: none;
            padding: 16px;
            border-radius: 8px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* slot 내부 버튼 스타일 (대체 방법) */
        #ar-button-slot {
            background: white;
            border-radius: 8px;
            padding: 12px 24px;
            border: 1px solid #ccc;
            position: absolute;
            bottom: 16px;
            right: 16px;
        }
    </style>
</head>
<body>
    <h1>AR DOM Overlay 테스트</h1>
    
    <!-- 방법 1: 기본 model-viewer 설정 -->
    <model-viewer
        id="viewer"
        src="./src/CERA_V11_low_Draco6_WebP_4K_001_self_optimize.glb"
        poster="./img/V11_thumbnail.webp"
        alt="세라젬 V11"
        camera-controls
        ar
        ar-modes="webxr"
        ar-placement="floor"
    >
        <!-- AR 버튼 커스터마이즈 (선택사항) -->
        <button slot="ar-button" id="ar-button-slot">
            AR로 보기
        </button>
    </model-viewer>

    <!-- 방법 1: AR 세션 중 표시할 컨트롤 (model-viewer 외부) -->
    <div class="ar-controls" id="external-controls">
        <button class="ar-button" onclick="console.log('모드 전환')">모드 전환</button>
        <button class="ar-button" onclick="console.log('텍스처 변경')">텍스처 변경</button>
        <button class="ar-button" onclick="console.log('회전')">90° 회전</button>
    </div>

    <script>
        const viewer = document.getElementById('viewer');
        const controls = document.getElementById('external-controls');
        
        // AR 상태 모니터링
        viewer.addEventListener('ar-status', (event) => {
            console.log('AR Status:', event.detail.status);
            
            if (event.detail.status === 'session-started') {
                // AR 세션 시작
                console.log('✅ AR 세션 활성화');
                controls.style.display = 'flex';
                
                // XR 세션 정보 확인
                if (viewer.xrSession) {
                    console.log('XR Session:', viewer.xrSession);
                    console.log('DOM Overlay State:', viewer.xrSession.domOverlayState);
                }
            } else {
                // AR 세션 종료
                controls.style.display = 'none';
            }
        });
        
        // 모델 로드 확인
        viewer.addEventListener('load', () => {
            console.log('✅ 모델 로드 완료');
            console.log('AR 지원:', viewer.canActivateAR);
        });
    </script>
</body>
</html>